import{Config}from"./config.js";!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(e){e.extend(e.summernote.plugins,{emoji:function(t){function o(){return s?(s=!1,""):r}var i=this,n=e.summernote.ui,a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});Array.prototype.filter||(Array.prototype.filter=function(e){var t=this.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=[],i=arguments[1],n=0;n<t;n++)if(n in this){var a=this[n];e.call(i,a,n,this)&&o.push(a)}return o});var r="",s=!1,c={},l=!!(window.chrome&&chrome.storage&&chrome.storage.local),m=!l&&!!window.localStorage;window.ConfigStorage={prefix:function(e){r=e},noPrefix:function(){s=!0},get:function(){var e,t,i,n=Array.prototype.slice.call(arguments),a=n.pop(),r=[],s=1==n.length,u=!0,f=o();for(t=0;t<n.length;t++)if("xt_"!=(i=n[t]=f+n[t]).substr(0,3)&&void 0!==c[i])r.push(c[i]);else if(m){try{e=localStorage.getItem(i)}catch(e){m=!1}try{e=void 0!==e&&null!==e&&JSON.parse(e)}catch(t){e=!1}r.push(c[i]=e)}else l?u=!1:r.push(c[i]=!1);if(u)return a(s?r[0]:r);chrome.storage.local.get(n,function(e){var o;for(r=[],t=0;t<n.length;t++)o=void 0!==(o=e[i=n[t]])&&null!==o&&JSON.parse(o),r.push(c[i]=o);a(s?r[0]:r)})},set:function(e,t){var i,n,a={},r=o();for(i in e)if(e.hasOwnProperty(i))if(n=e[i],i=r+i,c[i]=n,n=JSON.stringify(n),m)try{localStorage.setItem(i,n)}catch(e){m=!1}else a[i]=n;!m&&l?chrome.storage.local.set(a,t):t&&t()},remove:function(){var e,t,i,n=Array.prototype.slice.call(arguments),a=o();for("function"==typeof n[n.length-1]&&(i=n.pop()),e=0;e<n.length;e++)if(t=n[e]=a+n[e],delete c[t],m)try{localStorage.removeItem(t)}catch(e){m=!1}l?chrome.storage.local.remove(n,i):i&&i()}};var u=function(t){var o=e("."+a+" .emoji-items");o.html(""),t>0?e.each(i.icons,function(e,n){i.icons.hasOwnProperty(e)&&n[0]===t-1&&o.append('<a href="javascript:void(0)" title="'+Config.htmlEntities(e)+'">'+f(n,!0)+'<span class="label">'+Config.htmlEntities(e)+"</span></a>")}):ConfigStorage.get("emojis_recent",function(e){e=e||Config.defaultRecentEmojis||[];var t,n;for(n=0;n<e.length;n++)t=e[n],i.icons[t]&&o.append('<a href="javascript:void(0)" title="'+Config.htmlEntities(t)+'">'+f(i.icons[t],!0)+'<span class="label">'+Config.htmlEntities(t)+"</span></a>")})},f=function(e){var t=e[0],o=e[1],i=e[2],n=e[3],a=document.emojiSource+"/emoji_spritesheet_!.png",r=document.emojiSource+"/blank.gif",s=-25*i,c=-25*o,l=25*Config.EmojiCategorySpritesheetDimens[t][1],m=25*Config.EmojiCategorySpritesheetDimens[t][0],u="display:inline-block;";return u+="width:25px;",u+="height:25px;",u+="background:url('"+a.replace("!",t)+"') "+s+"px "+c+"px no-repeat;",u+="background-size:"+l+"px "+m+"px;",'<img src="'+r+'" class="img" style="'+u+'" alt="'+Config.htmlEntities(n)+'">'},d=function(e){return e.replace(Config.rx_colons,function(e){return Config.mapcolon[e]||""})};t.memo("button.emoji",function(){void 0===document.emojiButton&&(document.emojiButton="fa-regular fa-face-smile");var e=n.button({contents:'<i class="'+document.emojiButton+' emoji-picker-container emoji-picker"></i>',click:function(){void 0===document.emojiSource&&(document.emojiSource=""),void 0===document.emojiType&&(document.emojiType="");i.$panel.width()>i.$panel.position().left&&i.$panel.css({left:"0",top:"100%"}),i.$panel.show()}});return i.emoji=e.render(),i.emoji}),this.events={"summernote.init":function(o,n){!function(){var o=e("body");o.on("keydown",function(e){27!==e.keyCode&&9!==e.keyCode||i.$panel.hide()}),o.on("mouseup",function(t){var o=(t=t.originalEvent||t).target||window;e(o).hasClass("emoji-picker")||e(o).hasClass("emoji-menu-tab")||i.$panel.hide()}),o.on("click","."+a+" .emoji-menu-tab",function(t){t.stopPropagation(),t.preventDefault();var o=0,i=e(this).attr("class").split(" ");3!==(i=i[1].split("-")).length&&(i=i[0]+"-"+i[1],e("."+a+" .emoji-menu-tabs td").each(function(t){var n=e(this).find("a"),a=n.attr("class").split(" ");a=(a=a[1].split("-"))[0]+"-"+a[1],i===a?(n.attr("class","emoji-menu-tab "+a+"-selected"),o=t):n.attr("class","emoji-menu-tab "+a)}),u(o))}),e(document).on("click","."+a+" .emoji-items a",function(){var o=e(".label",e(this)).text();if("unicode"===document.emojiType)t.invoke("editor.insertText",d(o));else{var n=e(f(i.icons[o]));n[0].attachEvent&&n[0].attachEvent("onresizestart",function(e){e.returnValue=!1},!1),t.invoke("editor.insertNode",n[0])}ConfigStorage.get("emojis_recent",function(e){var t=(e=e||Config.defaultRecentEmojis||[]).indexOf(o);if(!t)return!1;-1!==t&&e.splice(t,1),e.unshift(o),e.length>42&&(e=e.slice(42)),ConfigStorage.set({emojis_recent:e})})})}()}},this.initialize=function(){this.$panel=e('<div class="emoji-menu '+a+'">\n    <div class="emoji-items-wrap1">\n        <table class="emoji-menu-tabs">\n            <tbody>\n            <tr>\n                <td><a class="emoji-menu-tab icon-recent-selected"></a></td>\n                <td><a class="emoji-menu-tab icon-smile"></a></td>\n                <td><a class="emoji-menu-tab icon-flower"></a></td>\n                <td><a class="emoji-menu-tab icon-bell"></a></td>\n                <td><a class="emoji-menu-tab icon-car"></a></td>\n                <td><a class="emoji-menu-tab icon-grid"></a></td>\n            </tr>\n            </tbody>\n        </table>\n        <div class="emoji-items-wrap mobile_scrollable_wrap">\n            <div class="emoji-items"></div>\n        </div>\n    </div>\n</div>').hide(),void 0!==this.emoji&&(this.$panel.appendTo(this.emoji.parent()),function(){var e,t,o,n,a,r,s,c,l;for(o=void 0,a=void 0,n={},s={},r=void 0,t=void 0,c=void 0,e=void 0,l=void 0,a=0;a<Config.EmojiCategories.length;){for(l=Config.EmojiCategorySpritesheetDimens[a][1],o=0;o<Config.EmojiCategories[a].length;)r=(t=Config.Emoji[Config.EmojiCategories[a][o]])[1][0],c=Math.floor(o/l),e=o%l,n[":"+r+":"]=[a,c,e,":"+r+":"],s[r]=t[0],o++;a++}i.icons=n,i.reverseIcons=s,Config.rx_codes||Config.init_unified()}(),u(0))},this.destroy=function(){this.$panel.remove(),this.$panel=null}}})});